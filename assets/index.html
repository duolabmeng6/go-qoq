<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge, Chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <link rel="icon" type="image/png" href="data:image/png;base64,iVBORw0KGgo=">

    <script src="vue2.js"></script>
    <script src="tailwindcss.3.2.6.js"></script>
    <!-- Main Srcs -->
    <link rel="stylesheet" href="main.css"/>

    <script src="main.js"></script>
</head>

<body>
<!--https://play.tailwindcss.com/OftDxjUQfY-->

<div id="app" class="pl-2 pr-1 Sans-serif">
    <div class="flex pt-2 items-center" @mousedown="startDrag" style="--wails-draggable:drag">
        <div class="">
            <div class="mr-2 ico-btn" @mousedown.stop="操作_钉着窗口(this)"
                 :class="{ 'ico-btn-click': 钉住状态 ,  'ico-btn-reset': !钉住状态 }">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 1024 1024" stroke-width="1.5"
                     stroke="currentColor" class="h-6 w-6">
                    <path d="M878.3 392.1L631.9 145.7c-6.5-6.5-15-9.7-23.5-9.7s-17 3.2-23.5 9.7L423.8 306.9c-12.2-1.4-24.5-2-36.8-2-73.2 0-146.4 24.1-206.5 72.3-15.4 12.3-16.7 35.4-2.7 49.4l181.7 181.7-215.4 215.2c-2.6 2.6-4.3 6.1-4.6 9.8l-3.4 37.2c-0.9 9.4 6.6 17.4 15.9 17.4 0.5 0 1 0 1.5-0.1l37.2-3.4c3.7-0.3 7.2-2 9.8-4.6l215.4-215.4 181.7 181.7c6.5 6.5 15 9.7 23.5 9.7 9.7 0 19.3-4.2 25.9-12.4 56.3-70.3 79.7-158.3 70.2-243.4l161.1-161.1c12.9-12.8 12.9-33.8 0-46.8zM666.2 549.3l-24.5 24.5 3.8 34.4c3.7 33.7 1 67.2-8.2 99.7-5.4 19-12.8 37.1-22.2 54.2L262 408.8c12.9-7.1 26.3-13.1 40.3-17.9 27.2-9.4 55.7-14.1 84.7-14.1 9.6 0 19.3 0.5 28.9 1.6l34.4 3.8 24.5-24.5L608.5 224 800 415.5 666.2 549.3z"
                          fill="#000000"></path>
                </svg>
            </div>
        </div>
        <div class="flex-grow"></div>
        <div class="flex flex-none">
            <!--      <div class="mr-2 ico-btn">-->
            <!--        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">-->
            <!--          <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.61l-4.725-2.885a.563.563 0 00-.586 0L6.982 20.54a.562.562 0 01-.84-.61l1.285-5.386a.562.562 0 00-.182-.557l-4.204-3.602a.563.563 0 01.321-.988l5.518-.442a.563.563 0 00.475-.345L11.48 3.5z" />-->
            <!--        </svg>-->
            <!--      </div>-->
            <div class="mr-2 ico-btn" @mousedown.stop="操作_截图翻译()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 1024 1024" stroke-width="1.5"
                     stroke="currentColor" class="h-6 w-6">
                    <path d="M512 577.984l-107.008 152.96c0.64 41.408-11.328 77.056-36.032 107.072-24.64 29.952-57.28 48.64-97.984 56-40.64 5.952-77.44-1.344-110.528-22.016-32.96-20.672-55.808-50.688-68.48-90.048a157.44 157.44 0 0 1 7.488-112.512c16.32-35.648 43.136-62.144 80.512-79.488 38.016-16 75.648-18.176 112.96-6.464 37.376 11.648 67.008 34.816 88.96 69.504L472.96 522.88 196.928 128a28.864 28.864 0 0 1-5.504-23.488 32.768 32.768 0 0 1 13.504-20.48 28.736 28.736 0 0 1 23.488-5.504c8.32 1.664 15.168 6.144 20.48 13.44l393.024 561.024c22.72-34.624 52.48-57.792 89.536-69.504 36.992-11.648 74.496-9.472 112.512 6.528 37.312 17.28 64.192 43.84 80.512 79.488 16.32 35.648 18.816 73.152 7.488 112.512-12.672 39.296-35.52 69.312-68.48 89.984a160.512 160.512 0 0 1-208-33.984c-25.024-29.952-37.184-65.664-36.544-107.008L512 577.984z m54.016-188.992l208.96-296.96a32.64 32.64 0 0 1 20.48-13.568 28.8 28.8 0 0 1 23.552 5.504c7.296 5.376 11.84 12.16 13.44 20.48a28.672 28.672 0 0 1-5.44 23.552L606.016 444.992l-39.04-56h-0.96z m-376 425.984c14.72 10.048 30.336 15.872 46.976 17.536 16.64 1.664 33.024-1.216 49.024-8.512 16-7.36 28.8-18.048 38.464-32 9.664-14.016 15.36-29.696 17.024-47.04a91.136 91.136 0 0 0-8.512-48.96 95.488 95.488 0 0 0-33.024-38.016c-22.656-14.72-46.336-19.712-71.04-15.04a92.16 92.16 0 0 0-59.968 40c-15.36 22.016-20.992 45.376-16.96 70.016 4.032 24.704 16.64 45.376 38.016 62.08z m643.968 0a95.04 95.04 0 0 0 41.984-87.488 92.416 92.416 0 0 0-55.488-79.488 97.088 97.088 0 0 0-50.048-8.512 89.728 89.728 0 0 0-46.464 18.496c-21.312 16-33.984 36.48-38.016 61.44-4.032 25.024 1.664 48.384 16.96 70.08 15.36 21.632 35.392 34.816 60.032 39.488 24.64 4.608 48.32 0 71.04-14.08v0.064z"
                          fill="#000000"></path>
                </svg>
            </div>
            <!--      <div class="mr-2 ico-btn">-->
            <!--        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6">-->
            <!--          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />-->
            <!--        </svg>-->
            <!--      </div>-->
            <div class="mr-2 ico-btn" @mousedown.stop="操作_弹出菜单()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="h-6 w-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/>
                </svg>
            </div>
        </div>
    </div>
    <div v-show="显示输入框" class="mt-2 overflow-hidden rounded-md p-2 pb-4 border-gray-200 border"
         style="background:rgb(246, 246, 246)">
        <div class="w-auto">
      <textarea class="w-auto border-none p-2 text-sm outline-none focus:outline-none"
                style="width:100%;background:rgb(246, 246, 246)" name="content" id="" cols="30" rows="4"
                v-model="翻译内容"
                @keydown="onKeyDown">{{ 翻译内容 }}</textarea>
        </div>
        <div class="flex items-center rounded-md">
            <div class="mr-2 ico-btn" @click="操作_播放声音(翻译内容)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor"
                     class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"/>
                </svg>
            </div>
            <div class="mr-2 ico-btn" @click="操作_复制(翻译内容)">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor"
                     class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-7.5A2.25 2.25 0 018.25 18v-1.5m8.25-8.25h-6a2.25 2.25 0 00-2.25 2.25v6"/>
                </svg>
            </div>
            <div class="pr- rounded-full bg-gray-200 p-1 pl-2 pr-2 text-xs text-gray-600 select-none">识别为<span
                    class="text-blue-500">{{
          识别语言 }}</span></div>
        </div>
    </div>
    <div v-show="显示语言切换栏"
         class="mt-2 flex items-center justify-center rounded-md p-0 select-none border-gray-200 border"
         style="background:rgb(246, 246, 246)">
        <div class="mr-8 text-xs">

            <select v-model="源语言" @change="handleLanguageChange"
                    class="mac-select bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2 outline-none border-none"
                    style="background:rgb(246, 246, 246)">
                <option v-for="language in 语言列表"
                        :key="language.value"
                        :value="language.value">
                    {{ language.name }}
            </select>
        </div>
        <div class="flex-grow-0 ico-btn" @click="操作_互换翻译结果()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                 stroke="currentColor"
                 class="h-4 w-4">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/>
            </svg>
        </div>
        <div class="ml-8 text-xs">
            <select v-model="目标语言" @change="handleLanguageChange2"
                    class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2 outline-none border-none"
                    style="background:rgb(246, 246, 246)">
                <option v-for="language in 语言列表"
                        :key="language.value"
                        :value="language.value">
                    {{ language.name }}
            </select>

        </div>
    </div>

    <div class="mt-2 w-auto rounded-md overflow-hidden border-gray-200 border" style="background:rgb(246, 246, 246)"
         v-for="(o, index) in 列表"
         :key="o.name">
        <div class="flex items-center justify-center select-none pt-2 pl-2 pr-2 pb-2 "
             style="background:rgb(241, 241, 241)" style="height:24px;" @click="togglePanel(index)">
            <div style="" class="">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor"
                     class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round"
                          d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.068.157 2.148.279 3.238.364.466.037.893.281 1.153.671L12 21l2.652-3.978c.26-.39.687-.634 1.153-.67 1.09-.086 2.17-.208 3.238-.365 1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z"/>
                </svg>
            </div>
            <div class="ml-2 flex-grow text-xs">{{ o.名称 }}</div>
            <div class="ico-btn2" :class="{ 'ico-jiaobiao': isOpen[index] ,  'ico-jiaobiao-active': !isOpen[index] }">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                     stroke="currentColor" class="h-4 w-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"/>
                </svg>
            </div>
        </div>
        <div :class="{ 'hidden': !isOpen[index] }" class="pt-1 pl-2 pr-2 pb-1">
            <div class="h-auto min-h-0 max-h-96 overflow-auto">
                <p class="whitespace-pre-line text-sm selectable">{{ o.结果 }}</p>
            </div>
            <div class="mt-2 flex" v-if="o.结果">
                <div class="mr-2 ico-btn" @click="操作_播放声音(o.结果)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="h-4 w-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M5.25 5.653c0-.856.917-1.398 1.667-.986l11.54 6.348a1.125 1.125 0 010 1.971l-11.54 6.347a1.125 1.125 0 01-1.667-.985V5.653z"/>
                    </svg>
                </div>
                <div class="ico-btn" @click="操作_复制(o.结果)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                         stroke="currentColor" class="h-4 w-4">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M16.5 8.25V6a2.25 2.25 0 00-2.25-2.25H6A2.25 2.25 0 003.75 6v8.25A2.25 2.25 0 006 16.5h2.25m8.25-8.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-7.5A2.25 2.25 0 018.25 18v-1.5m8.25-8.25h-6a2.25 2.25 0 00-2.25 2.25v6"/>
                    </svg>
                    </svg>
                </div>
            </div>
        </div>

    </div>
</div>

</body>


<script>
    var app = new Vue({
        el: '#app',
        data: {
            isOpen: [],
            移动状态: false,
            显示输入框: true,
            显示语言切换栏: true,
            源语言: 'auto',
            目标语言: 'auto',
            识别语言: '中文',
            语言列表: [
                {name: '自动检测', value: 'auto'},
                {name: '中文', value: 'zh'},
                {name: '英语', value: 'en'},
                {name: '日语', value: 'ja'},
                {name: '韩语', value: 'ko'},
            ],
            钉住状态: false,
            平台列表: [],
            翻译内容: '',
            列表: [
                // {
                //     名称: "",
                //     结果: ""
                // },
            ],
            内容的高度: 0,
        },
        mounted: function () {
            //3秒后执行
            dthis = this
            setTimeout(function () {
                dthis.init();
            }, 1000);
        },
        methods: {
            //页面初始化
            init() {
                dthis = this
                console.log("init")
                PyAction("操作_获取平台列表", "", function (data) {
                    data = JSON.parse(data)
                    console.log("操作_获取平台列表", data)
                    dthis.平台列表 = data.平台列表
                    dthis.isOpen = data.isOpen

                    // dthis.钉住状态 = data.钉住状态
                    dthis.显示输入框 = data.显示输入框
                    dthis.显示语言切换栏 = data.显示语言切换栏
                    dthis.语言列表 = data.语言列表
                    dthis.restRect();

                })
                wails.Events.On("setContent", function (data) {
                    console.log("setContent", data)
                    console.log("setContent", data.data)
                    dthis.翻译内容 = data.data
                    dthis.开始获取翻译内容()
                })
                // wails.Events.On("actionJieTuFanYi", function (data) {
                //     console.log("actionJieTuFanYi", data)
                //     dthis.操作_截图翻译()
                // })

            },
            restRect() {
                console.log("restRect")
                this.$nextTick(() => {
                    this.内容的高度 = document.getElementById('app').clientHeight;
                    PyAction("操作_内容高度", this.内容的高度+12, function (data) {

                    })
                });
            },
            togglePanel(index) {
                console.log(index)
                console.log(!this.isOpen[index])
                this.isOpen[index] = !this.isOpen[index];
                // 代码监听不到变化 所以手动触发
                this.$forceUpdate();

            },
            startDrag(event) {
                this.移动状态 = true
                PyAction("startDrag", "", function (data) {
                })
            },

            handleLanguageChange(event) {
                console.log('源语言 :', this.源语言);
                app.开始获取翻译内容()
            },
            handleLanguageChange2(event) {
                console.log('目标语言:', this.目标语言);
                app.开始获取翻译内容()
            },
            onKeyDown(event) {
                console.log("onKeyDown", event.key)

                if (event.key === 'Enter' && !event.ctrlKey) {
                    event.preventDefault(); // 阻止默认换行行为
                    this.开始获取翻译内容()
                }
                if (event.key === 'Enter' && event.ctrlKey) {
                    event.preventDefault(); // 阻止默认换行行为
                    const textarea = event.target;
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const value = this.翻译内容;
                    this.翻译内容 = value.substring(0, start) + '\n' + value.substring(end);
                    this.$nextTick(() => {
                        textarea.selectionStart = textarea.selectionEnd = start + 1;
                    })
                }
            },
            开始获取翻译内容() {
                console.log("开始获取翻译内容")
                dthis = this
                this.列表 = []
                if (this.翻译内容 == "") {
                    this.翻译内容 == ""
                    this.$forceUpdate();
                    this.restRect()
                    return
                }
                PyAction("操作_获取原文本语言", {
                    翻译内容: dthis.翻译内容,
                    源语言: dthis.源语言,
                }, function (data) {
                    data = JSON.parse(data)
                    // dthis.源语言 = data.源语言
                    // dthis.目标语言 = data.目标语言
                    dthis.翻译内容 = data.翻译内容
                    dthis.识别语言 = data.识别语言
                    go()
                })


                function go() {

                    for (var i = 0; i < dthis.平台列表.length; i++) {
                        平台名称 = dthis.平台列表[i]
                        console.log("翻译参数", "平台名称", 平台名称, "翻译内容", dthis.翻译内容, "源语言", dthis.源语言, "目标语言", dthis.目标语言)
                        插入翻译列表({
                            名称: 平台名称,
                            结果: "查询中……"
                        })
                        js_translate(平台名称, dthis.翻译内容, dthis.源语言, dthis.目标语言, function (ret) {
                            插入翻译列表({
                                名称: ret.名称,
                                结果: ret.结果,
                            })
                        });
                    }
                }

            },
            操作_播放声音(o) {
                event.preventDefault();          // 阻止默认换行行为

                console.log("操作_播放声音", o)
                PyAction("操作_播放声音", o, function (data) {

                })
            },
            操作_复制(o) {
                event.preventDefault();
                print("操作_复制")
                PyAction("操作_复制", o, function (data) {

                })
            },
            操作_钉着窗口(o) {
                event.preventDefault();
                print("操作_钉着窗口", this.钉住状态)
                this.钉住状态 = !this.钉住状态
                PyAction("操作_钉着窗口", this.钉住状态, function (data) {

                })
            },
            操作_截图翻译() {
                dthis = this
                print("操作_截图翻译")
                PyAction("操作_截图翻译", "", function (data) {

                })
            },
            操作_弹出菜单() {
                event.preventDefault();
                // print("操作_弹出菜单")
                //
                PyAction("操作_弹出菜单", "", function (data) {

                })
                // window.location.href = "./index_set.html"

            },
            操作_互换翻译结果() {
                a = this.源语言
                this.源语言 = this.目标语言
                this.目标语言 = a

                print("操作_互换翻译结果", this.源语言, this.目标语言)
                app.开始获取翻译内容()
                // PyAction("操作_互换翻译结果", JSON.stringify([this.源语言, this.目标语言]), function (data) {
                //
                // })
            },
        }

    })

    //
    // setTimeout(function () {
    //     console.log("123")
    //     app.$data.翻译内容 = "Laravelis a web application framework withexpressive,elegant syntax. We've already laid thefoundation - freeing you to create without sweatingthe small things."
    //     app.$data.列表 =
    //         [
    //             {
    //                 名称: "有道翻译",
    //                 结果: "Laravel是一个web应用程序框架，具有丰富的、优雅的语法。我们已经奠定了基础-解放你去创造，而不必为小事而烦恼。"
    //             },
    //             {
    //                 名称: "腾讯翻译君",
    //                 结果: "Laravel是一个web应用程序框架，具有丰富的、优雅的语法。我们已经奠定了基础-解放你去创造，而不必为小事而烦恼。"
    //             },
    //             {
    //                 名称: "百度翻译",
    //                 结果: "Laravel是一个web应用程序框架，具有丰富的、优雅的语法。我们已经奠定了基础-解放你去创造，而不必为小事而烦恼。"
    //             },
    //         ]
    // }, 1000)

    function 插入翻译列表(data) {
        // console.log("插入翻译列表", data)
        // data = JSON.parse(data)
        console.log("插入翻译列表", data)

        名称 = data.名称
        结果 = data.结果
        // 遍历 app.$data.列表 里面的名称，如果有相同的就替换，没有就插入
        for (var i = 0; i < app.$data.列表.length; i++) {
            if (app.$data.列表[i].名称 === 名称) {
                // alert(结果)
                app.$data.列表[i].结果 = 结果
                app.restRect()
                return
            }
        }
        app.$data.列表.push({
            名称: 名称,
            结果: 结果
        })
        app.restRect()

    }

</script>

</html>
